# üìã –°–¢–†–£–ö–¢–£–†–ê –ü–†–û–ï–ö–¢–ê MERCHANT BOT

## üèóÔ∏è –ê–†–•–ò–¢–ï–ö–¢–£–†–ê –ü–†–û–ï–ö–¢–ê

### üìÅ –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ–∞–π–ª—ã:

- `MerchantBot.py` - –ì–ª–∞–≤–Ω—ã–π —Ñ–∞–π–ª –±–æ—Ç–∞
- `config.py` - –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è (—Ç–æ–∫–µ–Ω, API URLs, –Ω–∞—Å—Ç—Ä–æ–π–∫–∏)
- `constants.py` - –í—Å–µ —Å–æ–æ–±—â–µ–Ω–∏—è –∏ –∫–Ω–æ–ø–∫–∏
- `states.py` - –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è–º–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- `db_utils.py` - –†–∞–±–æ—Ç–∞ —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö SQLite
- `api_client.py` - –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Konvert2pay API
- `webhook_sender.py` - –û—Ç–ø—Ä–∞–≤–∫–∞ webhook —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
- `message_handlers.py` - –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ç–µ–∫—Å—Ç–æ–≤—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π
- `callback_handlers.py` - –û–±—Ä–∞–±–æ—Ç–∫–∞ –Ω–∞–∂–∞—Ç–∏–π –∫–Ω–æ–ø–æ–∫
- `keyboard_manager.py` - –°–æ–∑–¥–∞–Ω–∏–µ –∫–ª–∞–≤–∏–∞—Ç—É—Ä

### üìÅ –ü–∞–ø–∫–∞ handlers/:

- `base.py` - –ë–∞–∑–æ–≤—ã–π –∫–ª–∞—Å—Å –¥–ª—è –∫–æ–º–∞–Ω–¥
- `merchant_commands.py` - –ö–æ–º–∞–Ω–¥—ã –¥–ª—è –º–µ—Ä—á–∞–Ω—Ç–æ–≤
- `admin_commands.py` - –ö–æ–º–∞–Ω–¥—ã –¥–ª—è –∞–¥–º–∏–Ω–æ–≤
- `command_dispatcher.py` - –î–∏—Å–ø–µ—Ç—á–µ—Ä –∫–æ–º–∞–Ω–¥

## üéØ –§–£–ù–ö–¶–ò–û–ù–ê–õ–¨–ù–û–°–¢–¨ –ë–û–¢–ê

### üë§ –î–õ–Ø –û–ë–´–ß–ù–´–• –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–ï–ô:

- –ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ —Å –ø—Ä–æ—Å—å–±–æ–π –æ–±—Ä–∞—Ç–∏—Ç—å—Å—è –∫ –∞–¥–º–∏–Ω—É
- –ù–µ—Ç –¥–æ—Å—Ç—É–ø–∞ –∫ —Ñ—É–Ω–∫—Ü–∏—è–º –º–µ—Ä—á–∞–Ω—Ç–∞

### üè™ –î–õ–Ø –ú–ï–†–ß–ê–ù–¢–û–í:

#### –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é –º–µ—Ä—á–∞–Ω—Ç–∞:

- üë§ –ü—Ä–æ—Ñ–∏–ª—å - –ü–æ–∫–∞–∑–∞—Ç—å –¥–∞–Ω–Ω—ã–µ –º–µ—Ä—á–∞–Ω—Ç–∞
- üìÑ –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è - –ü–æ–∫–∞–∑–∞—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω—ã–π –±–ª–æ–∫
- üé∞ –°–æ–∑–¥–∞—Ç—å –∏–Ω–≤–æ–π—Å - –°–æ–∑–¥–∞–Ω–∏–µ –ø–ª–∞—Ç–µ–∂–Ω—ã—Ö –∏–Ω–≤–æ–π—Å–æ–≤
- üíé –°–æ–∑–¥–∞—Ç—å –≤—ã–ø–ª–∞—Ç—É - –°–æ–∑–¥–∞–Ω–∏–µ –≤—ã–ø–ª–∞—Ç –∫–ª–∏–µ–Ω—Ç–∞–º
- ‚ùå –í—ã–π—Ç–∏ –∏–∑ –∞–∫–∫–∞—É–Ω—Ç–∞ - –û—Ç–≤—è–∑–∫–∞ –∞–∫–∫–∞—É–Ω—Ç–∞

#### üé∞ –°–æ–∑–¥–∞–Ω–∏–µ –∏–Ω–≤–æ–π—Å–∞:

1. –í—ã–±–æ—Ä –º–µ—Ç–æ–¥–∞: üí≥ Card, ‚ö° OneClick, üè¶ IBAN
2. –í–≤–æ–¥ ID –∏–Ω–≤–æ–π—Å–∞
3. –í–≤–æ–¥ ID –∫–ª–∏–µ–Ω—Ç–∞
4. –í–≤–æ–¥ —Å—É–º–º—ã
5. –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –∏ —Å–æ–∑–¥–∞–Ω–∏–µ

#### üíé –°–æ–∑–¥–∞–Ω–∏–µ –≤—ã–ø–ª–∞—Ç—ã:

1. –í—ã–±–æ—Ä –º–µ—Ç–æ–¥–∞: üí≥ Card, üè¶ IBAN
2. –í–≤–æ–¥ ID –∑–∞—è–≤–∫–∏
3. –í–≤–æ–¥ ID –∫–ª–∏–µ–Ω—Ç–∞
4. –í–≤–æ–¥ IBAN-—Å—á–µ—Ç–∞
5. –í–≤–æ–¥ –ò–ù–ù –∫–ª–∏–µ–Ω—Ç–∞
6. –í–≤–æ–¥ –§–ò–û –∫–ª–∏–µ–Ω—Ç–∞
7. –í–≤–æ–¥ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è –ø–ª–∞—Ç–µ–∂–∞
8. –í–≤–æ–¥ —Å—É–º–º—ã
9. –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –∏ —Å–æ–∑–¥–∞–Ω–∏–µ

### üë®‚Äçüíª –î–õ–Ø –ê–î–ú–ò–ù–û–í:

#### –ê–¥–º–∏–Ω –ø–∞–Ω–µ–ª—å:

- üë§ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ - –°–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –º–µ—Ä—á–∞–Ω—Ç–æ–≤
- ‚úâÔ∏è –°–æ–∑–¥–∞—Ç—å —Ä–∞—Å—Å—ã–ª–∫—É - –ú–∞—Å—Å–æ–≤–∞—è —Ä–∞—Å—Å—ã–ª–∫–∞
- üë§ –î–æ–±–∞–≤–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è - –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –º–µ—Ä—á–∞–Ω—Ç–∞
- ‚ùå –£–¥–∞–ª–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è - –£–¥–∞–ª–µ–Ω–∏–µ –º–µ—Ä—á–∞–Ω—Ç–∞

#### –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:

1. –í–≤–æ–¥ @username
2. –í–≤–æ–¥ shop_id
3. –í–≤–æ–¥ shop_api_key
4. –í–≤–æ–¥ order_id_tag
5. –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ –ë–î

## üîÑ –ü–û–¢–û–ö–ò –†–ê–ë–û–¢–´

### üì± –ù–∞—á–∞–ª–æ —Ä–∞–±–æ—Ç—ã:

1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç /start
2. –ë–æ—Ç –ø—Ä–æ–≤–µ—Ä—è–µ—Ç, —è–≤–ª—è–µ—Ç—Å—è –ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–µ—Ä—á–∞–Ω—Ç–æ–º
3. –ï—Å–ª–∏ –º–µ—Ä—á–∞–Ω—Ç - –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é –º–µ—Ä—á–∞–Ω—Ç–∞
4. –ï—Å–ª–∏ –Ω–µ –º–µ—Ä—á–∞–Ω—Ç - –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ —Å –ø—Ä–æ—Å—å–±–æ–π –æ–±—Ä–∞—Ç–∏—Ç—å—Å—è –∫ –∞–¥–º–∏–Ω—É

### üé∞ –°–æ–∑–¥–∞–Ω–∏–µ –∏–Ω–≤–æ–π—Å–∞:

1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–∂–∏–º–∞–µ—Ç "üé∞ –°–æ–∑–¥–∞—Ç—å –∏–Ω–≤–æ–π—Å"
2. –í—ã–±–∏—Ä–∞–µ—Ç –º–µ—Ç–æ–¥ –ø–ª–∞—Ç–µ–∂–∞ (Card/OneClick/IBAN)
3. –í–≤–æ–¥–∏—Ç –¥–∞–Ω–Ω—ã–µ –ø–æ—à–∞–≥–æ–≤–æ
4. –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–∞–µ—Ç —Å–æ–∑–¥–∞–Ω–∏–µ
5. –ë–æ—Ç –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –∑–∞–ø—Ä–æ—Å –≤ Konvert2pay API
6. –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç webhook —Å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–º
7. –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é

### üíé –°–æ–∑–¥–∞–Ω–∏–µ –≤—ã–ø–ª–∞—Ç—ã:

1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–∂–∏–º–∞–µ—Ç "üíé –°–æ–∑–¥–∞—Ç—å –≤—ã–ø–ª–∞—Ç—É"
2. –í—ã–±–∏—Ä–∞–µ—Ç –º–µ—Ç–æ–¥ –≤—ã–ø–ª–∞—Ç—ã (Card/IBAN)
3. –í–≤–æ–¥–∏—Ç –¥–∞–Ω–Ω—ã–µ –ø–æ—à–∞–≥–æ–≤–æ
4. –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–∞–µ—Ç —Å–æ–∑–¥–∞–Ω–∏–µ
5. –ë–æ—Ç –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –∑–∞–ø—Ä–æ—Å –≤ Konvert2pay API
6. –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç webhook —Å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–º
7. –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é

## üóÑÔ∏è –ë–ê–ó–ê –î–ê–ù–ù–´–•

### –¢–∞–±–ª–∏—Ü—ã:

- `users` - –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –±–æ—Ç–∞
- `merchant_settings` - –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –º–µ—Ä—á–∞–Ω—Ç–æ–≤
- `info_block` - –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω—ã–π –∫–æ–Ω—Ç–µ–Ω—Ç
- `order_counters` - –°—á–µ—Ç—á–∏–∫–∏ –∑–∞–∫–∞–∑–æ–≤

## üîó –ò–ù–¢–ï–ì–†–ê–¶–ò–ò

### Konvert2pay API:

- –°–æ–∑–¥–∞–Ω–∏–µ –∏–Ω–≤–æ–π—Å–æ–≤
- –°–æ–∑–¥–∞–Ω–∏–µ –≤—ã–ø–ª–∞—Ç
- –ü–æ–ª—É—á–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –æ–ø–µ—Ä–∞—Ü–∏–π

### Webhook:

- –û—Ç–ø—Ä–∞–≤–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –Ω–∞ http://webhook-paytoday.online/webhook
- –°–æ–±—ã—Ç–∏—è: —Å–æ–∑–¥–∞–Ω–∏–µ –∏–Ω–≤–æ–π—Å–∞, —Å–æ–∑–¥–∞–Ω–∏–µ –≤—ã–ø–ª–∞—Ç—ã, –¥–µ–π—Å—Ç–≤–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

## üéÆ –ö–ù–û–ü–ö–ò –ò –ò–• –§–£–ù–ö–¶–ò–ò

### –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é –º–µ—Ä—á–∞–Ω—Ç–∞:

- üë§ –ü—Ä–æ—Ñ–∏–ª—å ‚Üí –ü–æ–∫–∞–∑–∞—Ç—å –¥–∞–Ω–Ω—ã–µ –º–µ—Ä—á–∞–Ω—Ç–∞
- üìÑ –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è ‚Üí –ü–æ–∫–∞–∑–∞—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω—ã–π –±–ª–æ–∫
- üé∞ –°–æ–∑–¥–∞—Ç—å –∏–Ω–≤–æ–π—Å ‚Üí –ó–∞–ø—É—Å—Ç–∏—Ç—å –ø—Ä–æ—Ü–µ—Å—Å —Å–æ–∑–¥–∞–Ω–∏—è –∏–Ω–≤–æ–π—Å–∞
- üíé –°–æ–∑–¥–∞—Ç—å –≤—ã–ø–ª–∞—Ç—É ‚Üí –ó–∞–ø—É—Å—Ç–∏—Ç—å –ø—Ä–æ—Ü–µ—Å—Å —Å–æ–∑–¥–∞–Ω–∏—è –≤—ã–ø–ª–∞—Ç—ã
- ‚ùå –í—ã–π—Ç–∏ –∏–∑ –∞–∫–∫–∞—É–Ω—Ç–∞ ‚Üí –û—Ç–≤—è–∑–∞—Ç—å –∞–∫–∫–∞—É–Ω—Ç

### –ê–¥–º–∏–Ω –ø–∞–Ω–µ–ª—å:

- üë§ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ ‚Üí –ü–æ–∫–∞–∑–∞—Ç—å —Å–ø–∏—Å–æ–∫ –º–µ—Ä—á–∞–Ω—Ç–æ–≤
- ‚úâÔ∏è –°–æ–∑–¥–∞—Ç—å —Ä–∞—Å—Å—ã–ª–∫—É ‚Üí –û—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ –≤—Å–µ–º –º–µ—Ä—á–∞–Ω—Ç–∞–º
- üë§ –î–æ–±–∞–≤–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è ‚Üí –î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤–æ–≥–æ –º–µ—Ä—á–∞–Ω—Ç–∞
- ‚ùå –£–¥–∞–ª–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è ‚Üí –£–¥–∞–ª–∏—Ç—å –º–µ—Ä—á–∞–Ω—Ç–∞

### Inline –∫–Ω–æ–ø–∫–∏:

- üí≥ Card ‚Üí –í—ã–±–æ—Ä –º–µ—Ç–æ–¥–∞ Card
- ‚ö° OneClick ‚Üí –í—ã–±–æ—Ä –º–µ—Ç–æ–¥–∞ OneClick
- üè¶ IBAN ‚Üí –í—ã–±–æ—Ä –º–µ—Ç–æ–¥–∞ IBAN
- ‚úÖ –ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å ‚Üí –ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å –¥–µ–π—Å—Ç–≤–∏–µ
- ‚ùå –û—Ç–º–µ–Ω–∞ ‚Üí –û—Ç–º–µ–Ω–∏—Ç—å –¥–µ–π—Å—Ç–≤–∏–µ
- –ü—Ä–æ–ø—É—Å—Ç–∏—Ç—å ‚Üí –ü—Ä–æ–ø—É—Å—Ç–∏—Ç—å –ø–æ–ª–µ (–¥–ª—è –æ—Ç—á–µ—Å—Ç–≤–∞)

### –ù–∞–≤–∏–≥–∞—Ü–∏—è:

- ‚óÄÔ∏è –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é ‚Üí –í–µ—Ä–Ω—É—Ç—å—Å—è –≤ –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é

## üîß –¢–ï–•–ù–ò–ß–ï–°–ö–ò–ï –î–ï–¢–ê–õ–ò

### –°–æ—Å—Ç–æ—è–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π:

- `WAITING_FOR_INVOICE_METHOD` - –û–∂–∏–¥–∞–Ω–∏–µ –≤—ã–±–æ—Ä–∞ –º–µ—Ç–æ–¥–∞ –∏–Ω–≤–æ–π—Å–∞
- `WAITING_FOR_INVOICE_ID` - –û–∂–∏–¥–∞–Ω–∏–µ ID –∏–Ω–≤–æ–π—Å–∞
- `WAITING_FOR_CLIENT_ID` - –û–∂–∏–¥–∞–Ω–∏–µ ID –∫–ª–∏–µ–Ω—Ç–∞
- `WAITING_FOR_AMOUNT` - –û–∂–∏–¥–∞–Ω–∏–µ —Å—É–º–º—ã
- `WAITING_FOR_PAYOUT_METHOD` - –û–∂–∏–¥–∞–Ω–∏–µ –≤—ã–±–æ—Ä–∞ –º–µ—Ç–æ–¥–∞ –≤—ã–ø–ª–∞—Ç—ã
- `WAITING_FOR_ORDER_ID` - –û–∂–∏–¥–∞–Ω–∏–µ ID –∑–∞—è–≤–∫–∏
- `WAITING_FOR_IBAN_ACCOUNT` - –û–∂–∏–¥–∞–Ω–∏–µ IBAN-—Å—á–µ—Ç–∞
- `WAITING_FOR_IBAN_INN` - –û–∂–∏–¥–∞–Ω–∏–µ –ò–ù–ù
- `WAITING_FOR_SURNAME` - –û–∂–∏–¥–∞–Ω–∏–µ —Ñ–∞–º–∏–ª–∏–∏
- `WAITING_FOR_NAME` - –û–∂–∏–¥–∞–Ω–∏–µ –∏–º–µ–Ω–∏
- `WAITING_FOR_MIDDLENAME` - –û–∂–∏–¥–∞–Ω–∏–µ –æ—Ç—á–µ—Å—Ç–≤–∞
- `WAITING_FOR_PURPOSE` - –û–∂–∏–¥–∞–Ω–∏–µ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è –ø–ª–∞—Ç–µ–∂–∞
- `WAITING_FOR_LOGOUT_CONFIRMATION` - –û–∂–∏–¥–∞–Ω–∏–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –≤—ã—Ö–æ–¥–∞

### –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏:

- `MessageHandlers` - –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ç–µ–∫—Å—Ç–æ–≤—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π
- `CallbackHandlers` - –û–±—Ä–∞–±–æ—Ç–∫–∞ –Ω–∞–∂–∞—Ç–∏–π –∫–Ω–æ–ø–æ–∫
- `CommandHandlers` - –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–æ–º–∞–Ω–¥ (/start, /admin)

### –ú–µ–Ω–µ–¥–∂–µ—Ä—ã:

- `DatabaseManager` - –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ë–î
- `UserManager` - –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏
- `InfoManager` - –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω—ã–º –±–ª–æ–∫–æ–º
- `OrderManager` - –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å—á–µ—Ç—á–∏–∫–∞–º–∏ –∑–∞–∫–∞–∑–æ–≤
- `KeyboardManager` - –°–æ–∑–¥–∞–Ω–∏–µ –∫–ª–∞–≤–∏–∞—Ç—É—Ä
